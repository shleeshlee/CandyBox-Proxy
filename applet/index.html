
<!DOCTYPE html>
<html lang="zh-CN" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GeminiProxy 1.0</title>
    <link rel="stylesheet" href="index.css">
    <!-- Import Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
            },
            colors: {
              log: {
                light: '#f8f6ff',
                dark: '#1e1b2e'
              }
            },
            animation: {
              'gradient-x': 'gradient-x 15s ease infinite',
            },
            keyframes: {
              'gradient-x': {
                '0%, 100%': {
                  'background-size': '200% 200%',
                  'background-position': 'left center'
                },
                '50%': {
                  'background-size': '200% 200%',
                  'background-position': 'right center'
                },
              },
            }
          }
        }
      }
    </script>
    <style>
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Toggle Switch Styles */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #a855f7;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #a855f7;
        }

        /* 心跳动画定义 */
        @keyframes heartbeat {
          0% { transform: scale(1); }
          15% { transform: scale(1.15); } /* 第一下咚 */
          30% { transform: scale(1); }
          45% { transform: scale(1.15); } /* 第二下咚 */
          60% { transform: scale(1); }
          100% { transform: scale(1); }
        }
        
        .heart-icon { 
            animation: heartbeat 1.5s infinite ease-in-out; 
            display: inline-flex; 
            align-items: center;
            justify-content: center;
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="h-screen transition-colors duration-500 font-sans 
    bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 
    dark:from-slate-950 dark:via-purple-950/40 dark:to-slate-900 
    text-slate-700 dark:text-purple-100 overflow-hidden selection:bg-purple-300 selection:text-purple-900">

<div class="flex flex-col h-full p-3 md:p-6 gap-3 md:gap-5 max-w-5xl mx-auto w-full">
    <!-- 顶部导航栏 -->
    <header class="flex justify-between items-center shrink-0 
        px-4 py-3 rounded-2xl transition-all duration-300
        bg-white/70 border border-white/60 backdrop-blur-xl shadow-sm
        dark:bg-slate-900/60 dark:border-purple-500/20">
        
        <div class="flex items-center gap-2">
            <!-- 心形 Logo -->
            <div class="heart-icon">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="heartGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#f472b6;stop-opacity:1" /> <!-- pink-400 -->
                            <stop offset="100%" style="stop-color:#a855f7;stop-opacity:1" /> <!-- purple-500 -->
                        </linearGradient>
                    </defs>
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="url(#heartGradient)"/>
                </svg>
            </div>
            <h1 class="text-lg font-bold tracking-tight text-slate-800 dark:text-white">
                GeminiProxy 
            </h1>
        </div>
        
        <div class="flex items-center gap-2">
            <!-- 身份信息 -->
            <div class="relative group" id="user-profile" title="点击切换账号">
                <a href="https://accounts.google.com/AddSession" target="_blank" 
                   class="flex items-center justify-center w-9 h-9 rounded-full 
                          bg-white/50 border border-white/40 
                          dark:bg-slate-800/50 dark:border-purple-500/30 transition-transform hover:scale-105 overflow-hidden">
                    <img id="user-avatar" src="https://lh3.googleusercontent.com/a/default-user=s96-c" alt="User" class="w-full h-full object-cover">
                </a>
            </div>

            <!-- WiFi 开关 -->
            <button id="wifi-btn" class="flex items-center justify-center w-9 h-9 rounded-full 
                bg-white/50 border border-white/40 text-slate-500
                dark:bg-slate-800/50 dark:border-purple-500/30 dark:text-purple-300
                hover:bg-white active:scale-95 transition-all duration-200" title="连接/断开服务">
                <span class="material-icons-round text-xl group-data-[connected=true]:text-emerald-500 transition-colors" id="wifi-icon">wifi_off</span>
            </button>

            <!-- 日夜切换 -->
            <button id="theme-btn" class="flex items-center justify-center w-9 h-9 rounded-full 
                bg-white/50 border border-white/40 text-amber-500
                dark:bg-slate-800/50 dark:border-purple-500/30 dark:text-purple-300
                hover:bg-white active:scale-95 transition-all duration-200" title="切换模式">
                <span class="material-icons-round text-xl" id="theme-icon">light_mode</span>
            </button>
        </div>
    </header>

    <!-- 主内容区容器 (Flex Col) -->
    <div class="flex-1 flex flex-col min-h-0 gap-3 md:gap-5">
        
        <!-- 上半部分：配置 + 监控 (可滚动，但通常较短) -->
        <div class="flex flex-col gap-3 shrink-0">
            <!-- 配置面板 -->
            <section class="p-4 rounded-2xl transition-all duration-300
                bg-white/70 border border-white/60 backdrop-blur-xl
                dark:bg-slate-900/60 dark:border-purple-500/20">
                
                <div class="flex flex-col gap-4">
                    <!-- URL Input -->
                    <div>
                        <input type="text" id="ws-url" value="ws://127.0.0.1:9998" placeholder="ws://..." 
                            class="w-full bg-white/50 dark:bg-slate-800/50 border border-slate-200 dark:border-purple-500/30 rounded-xl px-3 py-2.5 
                            text-sm font-mono focus:outline-none focus:ring-2 focus:ring-purple-400 dark:focus:ring-purple-600 transition-all text-slate-700 dark:text-purple-100 placeholder-slate-400">
                    </div>

                    <!-- Stream Mode Toggles -->
                    <div class="flex bg-slate-100/50 dark:bg-slate-800/50 p-1 rounded-xl border border-slate-200/50 dark:border-purple-500/20">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="streamMode" value="real" class="peer hidden">
                            <div class="py-2 text-center rounded-lg text-sm font-medium text-slate-500 dark:text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-purple-600 dark:peer-checked:text-purple-300 peer-checked:shadow-sm transition-all">
                                原生流式
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="streamMode" value="fake" checked class="peer hidden">
                            <div class="py-2 text-center rounded-lg text-sm font-medium text-slate-500 dark:text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-purple-600 dark:peer-checked:text-purple-300 peer-checked:shadow-sm transition-all">
                                伪流式
                            </div>
                        </label>
                    </div>

                    <!-- Collapsible Advanced Settings -->
                    <details class="group rounded-xl border border-slate-200/50 dark:border-purple-500/20 overflow-hidden bg-white/30 dark:bg-slate-800/30">
                        <summary class="flex justify-between items-center p-3 cursor-pointer select-none text-sm font-semibold text-slate-600 dark:text-purple-200 hover:bg-white/40 dark:hover:bg-slate-700/40 transition-colors">
                            <span>高级功能 & 策略</span>
                            <span class="material-icons-round text-lg text-slate-400 transition-transform group-open:rotate-180">expand_more</span>
                        </summary>
                        <div class="p-4 pt-2 border-t border-slate-200/50 dark:border-purple-500/20 space-y-4">
                            
                            <!-- Toggle 1: Redirect -->
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600 dark:text-purple-300">模型重定向 (2.5 &rarr; 3.0)</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="model-redirect" class="sr-only peer">
                                    <div class="w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-purple-500"></div>
                                </label>
                            </div>

                            <!-- Toggle 2: Thinking -->
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600 dark:text-purple-300">思考强度兼容</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="thinking-compat" class="sr-only peer">
                                    <div class="w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-purple-500"></div>
                                </label>
                            </div>

                            <!-- Toggle 3: Resume + Limit -->
                            <div class="flex justify-between items-center">
                                <div class="flex flex-col">
                                    <span class="text-sm text-slate-600 dark:text-purple-300">截断续写 (仅真流式)</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="flex items-center gap-1 bg-white/50 dark:bg-slate-900/50 rounded px-1.5 py-0.5 border border-slate-200 dark:border-purple-500/30">
                                        <span class="text-[10px] text-slate-400 uppercase">Retry</span>
                                        <input type="number" id="resume-limit" value="3" min="0" max="10" class="w-6 bg-transparent text-center text-xs font-mono focus:outline-none">
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="resume-on-prohibit" class="sr-only peer">
                                        <div class="w-9 h-5 bg-slate-200 peer-focus:outline-none rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-purple-500"></div>
                                    </label>
                                </div>
                            </div>

                            <!-- Keep Alive Select -->
                            <div class="pt-2">
                                <label class="text-xs text-slate-400 dark:text-purple-400/60 block mb-1">后台保活策略</label>
                                <select id="keep-alive-mode" class="w-full bg-white/60 dark:bg-slate-900/60 border border-slate-200 dark:border-purple-500/30 rounded-lg px-2 py-1.5 
                                    text-xs focus:outline-none focus:ring-1 focus:ring-purple-400 dark:text-purple-200">
                                    <option value="none">关闭 (默认)</option>
                                    <option value="audio">静默音频 (Silent Audio)</option>
                                    <option value="pip">画中画视频 (PiP Video)</option>
                                </select>
                            </div>
                        </div>
                    </details>
                </div>
            </section>

            <!-- 监控面板 (Horizontal Cards) -->
            <section class="p-4 rounded-2xl transition-all duration-300
                bg-white/70 border border-white/60 backdrop-blur-xl
                dark:bg-slate-900/60 dark:border-purple-500/20">
                
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="material-icons-round text-base text-purple-500">analytics</span>
                        <span class="font-bold text-sm text-slate-700 dark:text-purple-100">运行监控</span>
                        <!-- Status Dot -->
                        <div id="ws-status-dot" class="w-2.5 h-2.5 rounded-full bg-slate-300 dark:bg-slate-600 transition-all shadow-sm" title="离线"></div>
                    </div>
                    <div class="flex gap-1">
                        <button id="btn-clear-stats" class="w-7 h-7 flex items-center justify-center rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/50 text-slate-400 hover:text-purple-500 transition-colors" title="清空统计">
                            <span class="material-icons-round text-lg">delete_sweep</span>
                        </button>
                        <button id="btn-export-stats" class="w-7 h-7 flex items-center justify-center rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/50 text-slate-400 hover:text-purple-500 transition-colors" title="导出数据">
                            <span class="material-icons-round text-lg">save_alt</span>
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-2">
                    <!-- Call Count -->
                    <div class="flex flex-col items-center justify-center p-2 rounded-xl bg-white/50 dark:bg-slate-800/50 border border-slate-100 dark:border-purple-500/10">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Calls</span>
                        <span class="text-base font-bold font-mono text-slate-700 dark:text-purple-100" id="stat-calls">0</span>
                    </div>
                    <!-- Tokens -->
                    <div class="flex flex-col items-center justify-center p-2 rounded-xl bg-white/50 dark:bg-slate-800/50 border border-slate-100 dark:border-purple-500/10">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Tokens</span>
                        <span class="text-base font-bold font-mono text-purple-600 dark:text-purple-400" id="stat-tokens">0</span>
                    </div>
                    <!-- Uptime -->
                    <div class="flex flex-col items-center justify-center p-2 rounded-xl bg-white/50 dark:bg-slate-800/50 border border-slate-100 dark:border-purple-500/10">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Uptime</span>
                        <span class="text-xs font-bold font-mono text-slate-600 dark:text-purple-200 mt-1" id="stat-uptime">00:00:00</span>
                    </div>
                </div>
            </section>
        </div>

        <!-- 下半部分：日志 (Flex fill) -->
        <footer class="flex-1 flex flex-col min-h-[40vh] rounded-2xl overflow-hidden transition-all duration-300
            bg-log-light dark:bg-log-dark border border-white/60 dark:border-purple-500/20 shadow-inner">
            
            <div class="flex justify-between items-center px-4 py-2 bg-white/40 dark:bg-white/5 border-b border-slate-200/50 dark:border-white/5">
                <span class="text-xs font-bold text-slate-500 dark:text-slate-400 flex items-center gap-1">
                    <span class="material-icons-round text-sm">terminal</span>
                    SYSTEM LOGS
                </span>
                <button id="btn-clear-logs" class="text-slate-400 hover:text-red-500 transition-colors p-1 rounded-md hover:bg-white/50">
                    <span class="material-icons-round text-sm">block</span>
                </button>
            </div>
            
            <div class="flex-1 p-3 overflow-y-auto font-mono text-[11px] leading-relaxed scrollbar-thin scroll-smooth" id="log-container">
                <div class="text-amber-500 border-l-2 border-amber-500 pl-2 mb-1 opacity-80">[System] Ready.</div>
            </div>
        </footer>

    </div>
</div>

<!-- 隐藏的保活元素 -->
<video id="pip-video" muted playsinline class="absolute w-px h-px opacity-0 pointer-events-none"></video>

<script src="index.js" type="module"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
